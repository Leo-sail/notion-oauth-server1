# ğŸš€ Notion OAuth æœåŠ¡å™¨ä½¿ç”¨è¯´æ˜

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„Notion OAuthæˆæƒæœåŠ¡å™¨ï¼Œæ”¯æŒæœ¬åœ°æµ‹è¯•å’ŒVerceläº‘ç«¯éƒ¨ç½²ã€‚ç”¨äºä¸ºCozeå¹³å°çš„Notionæ’ä»¶æä¾›OAuthæˆæƒåŠŸèƒ½ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
notion-oauth-server/
â”œâ”€â”€ api/                    # Verceléƒ¨ç½²ç”¨çš„APIç«¯ç‚¹
â”‚   â”œâ”€â”€ auth.py            # æˆæƒç«¯ç‚¹
â”‚   â””â”€â”€ callback.py        # å›è°ƒå¤„ç†
â”œâ”€â”€ venv/                  # Pythonè™šæ‹Ÿç¯å¢ƒï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ local_server.py        # æœ¬åœ°æµ‹è¯•æœåŠ¡å™¨
â”œâ”€â”€ start.sh              # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ requirements.txt       # Pythonä¾èµ–
â”œâ”€â”€ vercel.json           # Vercelé…ç½®
â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ README.md             # é¡¹ç›®è¯´æ˜
â””â”€â”€ ä½¿ç”¨è¯´æ˜.md            # æœ¬æ–‡ä»¶
```

## ğŸ”§ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

1. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   # å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
   cp .env.example .env
   
   # ç¼–è¾‘.envæ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„Notioné›†æˆä¿¡æ¯
   nano .env
   ```

2. **è¿è¡Œå¯åŠ¨è„šæœ¬**
   ```bash
   ./start.sh
   ```

3. **è®¿é—®æœåŠ¡å™¨**
   - æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:5000
   - ç‚¹å‡»"å¼€å§‹Notionæˆæƒ"æŒ‰é’®
   - å®Œæˆæˆæƒæµç¨‹

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

1. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   pip install flask requests
   ```

3. **è®¾ç½®ç¯å¢ƒå˜é‡**
   ```bash
   export NOTION_CLIENT_ID="your_client_id"
   export NOTION_CLIENT_SECRET="your_client_secret"
   export REDIRECT_URI="http://localhost:5000/oauth/callback"
   ```

4. **å¯åŠ¨æœåŠ¡å™¨**
   ```bash
   python local_server.py
   ```

## ğŸ”‘ Notioné›†æˆé…ç½®

### 1. åˆ›å»ºNotioné›†æˆ

1. è®¿é—® [Notioné›†æˆé¡µé¢](https://www.notion.so/my-integrations)
2. ç‚¹å‡»"+ New integration"
3. å¡«å†™é›†æˆä¿¡æ¯ï¼š
   - **Name**: ä½ çš„é›†æˆåç§°
   - **Logo**: å¯é€‰
   - **Associated workspace**: é€‰æ‹©å·¥ä½œåŒº

### 2. é…ç½®OAuthè®¾ç½®

1. åœ¨é›†æˆè®¾ç½®é¡µé¢ï¼Œæ‰¾åˆ°"OAuth Domain & URIs"éƒ¨åˆ†
2. æ·»åŠ Redirect URIï¼š
   - æœ¬åœ°æµ‹è¯•ï¼š`http://localhost:5000/oauth/callback`
   - Verceléƒ¨ç½²ï¼š`https://your-app.vercel.app/api/callback`
3. è®°å½•Client IDå’ŒClient Secret

### 3. è®¾ç½®æƒé™

åœ¨"Capabilities"éƒ¨åˆ†ï¼Œç¡®ä¿å¯ç”¨ä»¥ä¸‹æƒé™ï¼š
- âœ… Read content
- âœ… Update content
- âœ… Insert content

## ğŸŒ Verceléƒ¨ç½²

### 1. å‡†å¤‡ä»£ç 

é¡¹ç›®å·²åŒ…å«Verceléƒ¨ç½²æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ï¼š
- `api/auth.py` - æˆæƒç«¯ç‚¹
- `api/callback.py` - å›è°ƒå¤„ç†
- `vercel.json` - éƒ¨ç½²é…ç½®
- `requirements.txt` - ä¾èµ–åˆ—è¡¨

### 2. éƒ¨ç½²æ­¥éª¤

1. **ä¸Šä¼ åˆ°GitHub**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin https://github.com/yourusername/notion-oauth-server.git
   git push -u origin main
   ```

2. **åœ¨Vercelä¸­éƒ¨ç½²**
   - è®¿é—® [Vercel](https://vercel.com)
   - å¯¼å…¥GitHubé¡¹ç›®
   - é…ç½®ç¯å¢ƒå˜é‡
   - éƒ¨ç½²é¡¹ç›®

3. **é…ç½®ç¯å¢ƒå˜é‡**
   åœ¨Vercelé¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ï¼š
   - `NOTION_CLIENT_ID`
   - `NOTION_CLIENT_SECRET`
   - `REDIRECT_URI`

## ğŸ” æµ‹è¯•æˆæƒæµç¨‹

### æœ¬åœ°æµ‹è¯•

1. å¯åŠ¨æœåŠ¡å™¨åè®¿é—®ï¼šhttp://localhost:5000
2. æ£€æŸ¥é…ç½®çŠ¶æ€ï¼ˆåº”æ˜¾ç¤º"âœ… å·²é…ç½®"ï¼‰
3. ç‚¹å‡»"ğŸš€ å¼€å§‹Notionæˆæƒ"
4. åœ¨Notioné¡µé¢å®Œæˆæˆæƒ
5. è·å–è®¿é—®ä»¤ç‰Œ

### éªŒè¯ä»¤ç‰Œ

è·å–ä»¤ç‰Œåï¼Œå¯ä»¥æµ‹è¯•APIè°ƒç”¨ï¼š

```python
import requests

headers = {
    'Authorization': f'Bearer {access_token}',
    'Notion-Version': '2022-06-28'
}

response = requests.get('https://api.notion.com/v1/users/me', headers=headers)
print(response.json())
```

## ğŸ› ï¸ åœ¨Cozeæ’ä»¶ä¸­ä½¿ç”¨

### 1. è·å–è®¿é—®ä»¤ç‰Œ

- é€šè¿‡OAuthæµç¨‹è·å–`access_token`
- å¤åˆ¶ä»¤ç‰Œå¤‡ç”¨

### 2. åœ¨æ’ä»¶ä¸­é…ç½®

åœ¨Cozeæ’ä»¶çš„å·¥å…·å‚æ•°ä¸­æ·»åŠ ï¼š
```json
{
  "name": "notion_token",
  "type": "string",
  "description": "Notionè®¿é—®ä»¤ç‰Œ",
  "required": true
}
```

### 3. ä½¿ç”¨ä»¤ç‰Œ

åœ¨æ’ä»¶ä»£ç ä¸­ä½¿ç”¨ä»¤ç‰Œï¼š
```python
def query_notion_database(database_id, notion_token):
    headers = {
        'Authorization': f'Bearer {notion_token}',
        'Notion-Version': '2022-06-28',
        'Content-Type': 'application/json'
    }
    # ... APIè°ƒç”¨ä»£ç 
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨æ€§

- ğŸ”’ **ä¿æŠ¤Client Secret**ï¼šç»ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­æš´éœ²
- ğŸ›¡ï¸ **ä½¿ç”¨HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS
- ğŸ”„ **ä»¤ç‰Œç®¡ç†**ï¼šå®šæœŸè½®æ¢è®¿é—®ä»¤ç‰Œ
- ğŸ“ **è®¿é—®æ—¥å¿—**ï¼šç›‘æ§APIè®¿é—®æƒ…å†µ

### è°ƒè¯•æŠ€å·§

- ğŸ“Š **æŸ¥çœ‹æ—¥å¿—**ï¼šæœåŠ¡å™¨ä¼šè¾“å‡ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
- ğŸ” **æ£€æŸ¥é…ç½®**ï¼šç¡®ä¿ç¯å¢ƒå˜é‡æ­£ç¡®è®¾ç½®
- ğŸŒ **ç½‘ç»œé—®é¢˜**ï¼šæ£€æŸ¥é˜²ç«å¢™å’Œä»£ç†è®¾ç½®
- ğŸ“± **æµè§ˆå™¨**ï¼šä½¿ç”¨æ— ç—•æ¨¡å¼é¿å…ç¼“å­˜é—®é¢˜

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: æˆæƒå¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥Client IDã€Secretå’ŒRedirect URIæ˜¯å¦æ­£ç¡®é…ç½®

### Q: ä»¤ç‰Œè·å–å¤±è´¥ï¼Ÿ
A: ç¡®è®¤Notioné›†æˆæƒé™è®¾ç½®æ­£ç¡®ï¼Œæ£€æŸ¥APIç‰ˆæœ¬å…¼å®¹æ€§

### Q: æœ¬åœ°æœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥Pythonç‰ˆæœ¬ï¼ˆéœ€è¦3.7+ï¼‰ï¼Œç¡®ä¿ç«¯å£5000æœªè¢«å ç”¨

### Q: Verceléƒ¨ç½²å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥requirements.txtæ ¼å¼ï¼Œç¡®è®¤ç¯å¢ƒå˜é‡è®¾ç½®æ­£ç¡®

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç¯å¢ƒå˜é‡é…ç½®
2. Notioné›†æˆè®¾ç½®
3. ç½‘ç»œè¿æ¥çŠ¶æ€
4. Pythonç¯å¢ƒç‰ˆæœ¬

---

ğŸ‰ **æ­å–œï¼** ä½ å·²ç»æˆåŠŸè®¾ç½®äº†Notion OAuthæœåŠ¡å™¨ã€‚ç°åœ¨å¯ä»¥åœ¨Cozeæ’ä»¶ä¸­ä½¿ç”¨Notion APIäº†ï¼